<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; connect-src 'self' http://localhost:3001;">
    <title>Data Replicator</title>
</head>
<body>
    <div id="app">
        <header class="header">
            <div class="header-content">
                <div class="header-text">
                    <h1>Data Replicator</h1>
                    <p>Replicate databases using saved configurations</p>
                </div>
                <div class="header-actions">
                    <button id="settingsBtn" class="btn btn-secondary settings-btn">
                        <span class="settings-icon">⚙️</span>
                        Settings
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="content-layout">
                <div class="left-panel">
                    <!-- Saved Items Management Section -->
                    <section class="section">
                        <h2>Saved Items</h2>
                        <div class="tab-container">
                            <div class="tab-buttons">
                                <button class="tab-button active" data-tab="connections">Database Connections</button>
                                <button class="tab-button" data-tab="scripts">SQL Scripts</button>
                            </div>

                            <!-- Database Connections Tab -->
                            <div class="tab-content active" id="connections-tab">
                                <div class="storage-header">
                                    <button id="addConnectionBtn" class="btn btn-primary">Add Connection</button>
                                </div>
                                <div class="storage-list" id="connectionsList">
                                    <div class="empty-state">No saved connections</div>
                                </div>
                            </div>

                            <!-- SQL Scripts Tab -->
                            <div class="tab-content" id="scripts-tab">
                                <div class="storage-header">
                                    <button id="addScriptBtn" class="btn btn-primary">Add Script</button>
                                </div>
                                <div class="storage-list" id="scriptsList">
                                    <div class="empty-state">No saved scripts</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Configuration Management Section -->
                    <section class="section">
                        <h2>Replication Configurations</h2>
                        <div class="storage-header">
                            <button id="addConfigBtn" class="btn btn-primary">Create New Configuration</button>
                        </div>
                        <div class="storage-list" id="configsList">
                            <div class="empty-state">No configurations created yet</div>
                        </div>
                    </section>

                    <!-- Run Configuration Section -->
                    <section class="section">
                        <h2>Run Replication</h2>
                        <div class="form-group">
                            <label for="selectedConfigSelect">Select Configuration to Run:</label>
                            <select id="selectedConfigSelect">
                                <option value="">Choose a configuration...</option>
                            </select>
                        </div>
                        
                        <div id="configDetails" class="config-details mb-2" style="display: none;">
                            <h4>Configuration Details:</h4>
                            <div class="config-info">
                                <div class="info-item">
                                    <label>Source Database:</label>
                                    <span id="configSource">-</span>
                                </div>
                                <div class="info-item">
                                    <label>Target Database:</label>
                                    <span id="configTarget">-</span>
                                </div>
                                <div class="info-item">
                                    <label>Post-Replication Scripts:</label>
                                    <span id="configScripts">None</span>
                                </div>
                                <div class="info-item">
                                    <label>Last Run:</label>
                                    <span id="configLastRun">Never</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions mt-2">
                            <button id="startReplicationBtn" class="btn btn-primary" disabled>Start Replication</button>
                            <button id="cancelReplicationBtn" class="btn btn-danger" disabled>Cancel</button>
                        </div>
                        
                        <!-- Progress Section -->
                        <div class="progress-container" id="progressContainer" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div class="progress-text" id="progressText">0%</div>
                            <div class="status-message" id="statusMessage">Ready</div>
                        </div>
                    </section>
                </div>
                
                <div class="right-panel">
                    <!-- Logs Section -->
                    <section class="logs-section">
                        <h2>Replication Logs</h2>
                        <div class="logs-container">
                            <div id="logs" class="logs"></div>
                            <div class="logs-actions">
                                <button id="clearLogsBtn" class="btn btn-secondary">Clear Logs</button>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>

        <!-- Status Bar -->
        <footer class="status-bar">
            <span id="appInfo">Data Replicator v1.0</span>
            <span id="connectionStatus" class="status-disconnected">Ready</span>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Database Connection Modal -->
    <div id="connectionModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="connectionModalTitle">Add Database Connection</h3>
                <button id="connectionModalCloseBtn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="connectionForm">
                    <div class="form-group">
                        <label for="connectionName">Connection Name:</label>
                        <input type="text" id="connectionName" placeholder="e.g., Production Database" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="serverType">Server Type:</label>
                        <select id="serverType" required>
                            <option value="sqlserver">SQL Server (On-Premises)</option>
                            <option value="azure-sql">Azure SQL Database</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="server">Server:</label>
                        <input type="text" id="server" placeholder="e.g., localhost or server.database.windows.net" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="database">Database:</label>
                        <input type="text" id="database" placeholder="e.g., MyDatabase" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" placeholder="e.g., sa or user@domain.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" placeholder="Database password" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="port">Port (Optional):</label>
                        <input type="number" id="port" placeholder="e.g., 1433" min="1" max="65535">
                        <small>Leave empty to use default port</small>
                    </div>
                    
                    <div class="form-group">
                        <button type="button" id="testConnectionBtn" class="btn btn-secondary">Test Connection</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="connectionDescription">Description (Optional):</label>
                        <textarea 
                            id="connectionDescription" 
                            placeholder="Brief description of this connection"
                            rows="2"
                        ></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="isTargetDatabase">
                            <span class="checkmark"></span>
                            Mark as Target Database
                        </label>
                        <small>Target databases can be used as replication destinations</small>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button id="connectionModalCancelBtn" class="btn btn-secondary">Cancel</button>
                <button id="connectionModalSaveBtn" class="btn btn-primary">Save Connection</button>
            </div>
        </div>
    </div>

    <!-- SQL Script Modal -->
    <div id="sqlScriptModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="sqlScriptModalTitle">Add SQL Script</h3>
                <button id="sqlScriptModalCloseBtn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="sqlScriptForm">
                    <div class="form-group">
                        <label for="sqlScriptName">Script Name:</label>
                        <input type="text" id="sqlScriptName" placeholder="e.g., Set Environment Variables" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="sqlScriptContent">SQL Script:</label>
                        <textarea 
                            id="sqlScriptContent" 
                            placeholder="-- SQL commands to run after replication&#10;UPDATE Settings SET Environment = 'DEV';"
                            rows="8"
                            required
                        ></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="sqlScriptDescription">Description (Optional):</label>
                        <textarea 
                            id="sqlScriptDescription" 
                            placeholder="Brief description of what this script does"
                            rows="2"
                        ></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="sqlScriptModalCancelBtn" class="btn btn-secondary">Cancel</button>
                <button id="sqlScriptModalSaveBtn" class="btn btn-primary">Save Script</button>
            </div>
        </div>
    </div>

    <!-- Configuration Modal -->
    <div id="configModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="configModalTitle">Create Configuration</h3>
                <button id="configModalCloseBtn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="configForm">
                    <div class="form-group">
                        <label for="configName">Configuration Name:</label>
                        <input type="text" id="configName" placeholder="e.g., Production to Dev" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="sourceConnection">Source Database:</label>
                        <select id="sourceConnection" required>
                            <option value="">Select saved connection...</option>
                        </select>
                        <small>Choose from your saved database connections</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="targetConnection">Target Database:</label>
                        <select id="targetConnection" required>
                            <option value="">Select saved connection...</option>
                        </select>
                        <small>Only connections marked as "Target Database" will appear here. Target database will be created if it doesn't exist.</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Post-Replication Scripts (Optional):</label>
                        <div class="script-selection" id="scriptSelection">
                            <!-- Scripts will be populated here -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="configModalCancelBtn" class="btn btn-secondary">Cancel</button>
                <button id="configModalSaveBtn" class="btn btn-primary">Save Configuration</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Settings</h3>
                <button id="settingsModalCloseBtn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <div class="settings-tab-buttons">
                        <button class="settings-tab-button active" data-tab="import-export">Import/Export</button>
                        <button class="settings-tab-button" data-tab="general">General</button>
                    </div>

                    <!-- Import/Export Tab -->
                    <div class="settings-tab-content active" id="import-export-tab">
                        <h4>Configuration Import/Export</h4>
                        <p>Export your configurations to share with others or import existing configurations.</p>
                        
                        <!-- Export Section -->
                        <div class="settings-section">
                            <h5>Export Configuration</h5>
                            <div class="export-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="exportConnections" checked>
                                    <span class="checkmark"></span>
                                    Include Database Connections
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="exportScripts" checked>
                                    <span class="checkmark"></span>
                                    Include SQL Scripts
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="exportConfigs" checked>
                                    <span class="checkmark"></span>
                                    Include Replication Configurations
                                </label>
                            </div>
                            <div class="export-actions">
                                <button id="exportBtn" class="btn btn-primary">Export to File</button>
                            </div>
                        </div>

                        <!-- Import Section -->
                        <div class="settings-section">
                            <h5>Import Configuration</h5>
                            <div class="import-options">
                                <div class="form-group">
                                    <label for="importMode">Import Mode:</label>
                                    <select id="importMode">
                                        <option value="merge">Merge (Update existing, add new)</option>
                                        <option value="replace">Replace (Overwrite existing)</option>
                                        <option value="skip-duplicates">Skip Duplicates (Only add new)</option>
                                    </select>
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="generateNewIds" checked>
                                    <span class="checkmark"></span>
                                    Generate New IDs (Recommended)
                                </label>
                            </div>
                            <div class="import-actions">
                                <button id="importBtn" class="btn btn-primary">Import from File</button>
                            </div>
                        </div>
                    </div>

                    <!-- General Tab -->
                    <div class="settings-tab-content" id="general-tab">
                        <h4>General Settings</h4>
                        <p>Additional settings will be available here in future updates.</p>
                        
                        <div class="settings-section">
                            <h5>Application Information</h5>
                            <div class="app-info">
                                <div class="info-item">
                                    <label>Version:</label>
                                    <span id="appVersion">Loading...</span>
                                </div>
                                <div class="info-item">
                                    <label>Storage Location:</label>
                                    <span>data/storage.json</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="settingsModalCloseBtn2" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Import Preview Modal -->
    <div id="importPreviewModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Import Preview</h3>
                <button id="importPreviewModalCloseBtn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="importPreviewContent">
                    <!-- Preview content will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="importPreviewCancelBtn" class="btn btn-secondary">Cancel</button>
                <button id="importPreviewConfirmBtn" class="btn btn-primary">Confirm Import</button>
            </div>
        </div>
    </div>
</body>
</html> 